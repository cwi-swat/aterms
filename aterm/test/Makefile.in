# vim:ts=8:sw=8

PRODUCT		= @PRODUCT@
VERSION		= @VERSION@
CURDATE		= `date`

srcdir		= @srcdir@
top_srcdir	= @top_srcdir@
prefix		= @prefix@
exec_prefix	= @exec_prefix@
bindir      	= $(exec_prefix)/bin
libdir      	= $(exec_prefix)/lib
includedir  	= $(prefix)/include

CC_GCC		= @CC_GCC@
CC_CC		= @CC_CC@
CC_DBG		= @CC_DBG@
CC_PROF		= @CC_PROF@
CC_NS		= @CC_CC@

CFLAGS_CC	= @CFLAGS_CC@
CFLAGS_GCC	= @CFLAGS_GCC@
CFLAGS_DBG	= @CFLAGS_DBG@
CFLAGS_PROF	= @CFLAGS_PROF@
CFLAGS_NS	= @CFLAGS_CC@

DEFS_CC		= @DEFS_CC@
DEFS_GCC	= @DEFS_GCC@
DEFS_DBG	= @DEFS_DBG@
DEFS_PROF	= @DEFS_PROF@
DEFS_NS		= @DEFS_CC@ -DNO_SHARING

INCL_CC		= @INCL_CC@
INCL_GCC	= @INCL_GCC@
INCL_DBG	= @INCL_DBG@
INCL_PROF	= @INCL_PROF@
INCL_NS		= @INCL_CC@

LFLAGS_CC	= @LFLAGS_CC@
LFLAGS_GCC	= @LFLAGS_GCC@
LFLAGS_DBG	= @LFLAGS_DBG@
LFLAGS_PROF	= @LFLAGS_PROF@
LFLAGS_NS	= @LFLAGS_CC@ 

LIB_CC		= ../aterm/libATerm-cc.a ../asfix/libAsFix-cc.a \
		../toolbus/libATB-cc.a
LIB_GCC		= ../aterm/libATerm-gcc.a ../asfix/libAsFix-gcc.a \
		../toolbus/libATB-gcc.a
LIB_DBG		= ../aterm/libATerm-dbg.a ../asfix/libAsFix-dbg.a \
		../toolbus/libATB-dbg.a
LIB_PROF	= ../aterm/libATerm-prof.a ../asfix/libAsFix-prof.a \
		../toolbus/libATB-prof.a
LIB_NS		= ../aterm/libATerm-ns.a ../asfix/libAsFix-ns.a \
		../toolbus/libATB-ns.a

LIBS_CC		= -L../aterm -L../asfix -L../toolbus \
			-lATerm-cc -lAsFix-cc -lATB-cc @LIBS@
LIBS_GCC	= -L../aterm -L../asfix -L../toolbus \
			-lATerm-gcc -lAsFix-gcc -lATB-gcc @LIBS@
LIBS_DBG	= -L../aterm -L../asfix -L../toolbus \
			-lATerm-dbg -lAsFix-dbg -lATB-dbg @LIBS@
LIBS_PROF	= -L../aterm -L../asfix -L../toolbus \
			-lATerm-prof -lAsFix-prof -lATB-prof @LIBS@
LIBS_NS		= -L../aterm -L../asfix -L../toolbus \
			-lATerm-ns -lAsFix-dbg -lATB-dbg @LIBS@

INSTALL		= @INSTALL@
INSTALL_PRG	= @INSTALL_PRG@
INSTALL_DAT	= @INSTALL_DAT@

TOOLBUS		= @TOOLBUS@
INCL		= -I../asfix -I../aterm -I../toolbus
TESTPRGS	= stress-cc stress-gcc primes-cc primes-gcc asfixtest \
		stress-ns primes-ns test-tool test-tool2 randgen termstats
TESTSRCS	= stress.c asfixtest.c primes.c test-tool.c test-tool2.c \
		randgen.c termstats.c
TESTOBJS	= stress.o asfixtest.o primes.o test-tool.o test-tool2.o
DISTFILES	= test.tb test2.tb Test.asfix test.trms error.trm Makefile.in \
		test2.tifs ${TESTSRCS} .depend

all: $(TESTPRGS) $(TESTS)

clean:
	@CLEAN@ *.tif.c *.tif.h ${TESTPRGS}

dist: ${DISTFILES}
	@cp ${DISTFILES} ${DISTDIR}

install:

stress-cc: stress.c ${LIB_CC}
	$(CC_CC) $(CFLAGS_CC) $(DEFS_CC) $(INCL) $(LFLAGS) -o stress-cc stress.c $(LIBS_CC)

stress-gcc: stress.c ${LIB_DBG}
	$(CC_DBG) $(CFLAGS_DBG) $(DEFS_GCC) $(INCL) $(LFLAGS) -o stress-gcc stress.c $(LIBS_DBG)

stress-ns: stress.c ${LIB_NS}
	$(CC_NS) $(CFLAGS_NS) $(DEFS_NS) $(INCL) $(LFLAGS) -o stress-ns \
		stress.c $(LIBS_NS)

asfixtest: asfixtest.c ${LIB_DBG}
	$(CC_DBG) $(CFLAGS_DBG) $(DEFS_DBG) $(INCL) $(LFLAGS) -o asfixtest \
		asfixtest.c $(LIBS_DBG)

primes-cc: primes.c ${LIB_CC}
	$(CC_CC) $(CFLAGS_CC) $(DEFS_CC) $(INCL) $(LFLAGS) -o primes-cc primes.c $(LIBS_CC)

primes-ns: primes.c ${LIB_NS}
	$(CC_NS) $(CFLAGS_NS) $(DEFS_NS) $(INCL) $(LFLAGS) -o primes-ns primes.c $(LIBS_NS)

primes-gcc: primes.c ${LIB_DBG}
	$(CC_DBG) $(CFLAGS_DBG) $(INCL) $(LFLAGS) -o primes-gcc primes.c $(LIBS_DBG)

randgen: randgen.c ${LIB_CC}
	${CC_CC} $(CFLAGS_CC) $(DEFS_CC) $(INCL) $(LFLAGS) -o randgen randgen.c $(LIBS_CC) 

termstats: termstats.c ${LIB_CC}
	${CC_CC} $(CFLAGS_CC) $(DEFS_CC) $(INCL) $(LFLAGS) -o termstats termstats.c $(LIBS_CC) 

vararg1: vararg1.c ${LIB_DBG}
	${CC_DBG} ${CFLAGS_DBG} ${INCL} ${LFLAGS} -o vararg1 vararg1.c ${LIBS_DBG}

vararg2: vararg2.c ${LIB_DBG}
	${CC_DBG} ${CFLAGS_DBG} ${INCL} ${LFLAGS} -o vararg2 vararg2.c ${LIBS_DBG}

vararg3: vararg3.c ${LIB_DBG}
	${CC_DBG} ${CFLAGS_DBG} ${INCL} ${LFLAGS} -o vararg3 vararg3.c ${LIBS_DBG}

test-tool: test-tool.c ${LIB_DBG}
	$(CC_DBG) $(CFLAGS_DBG) $(INCL) $(LFLAGS) -o test-tool test-tool.c \
		-L../toolbus -lATB-dbg ${LIBS_DBG}

test-tool2: test-tool2.c tool2.tif.c tool2.tif.h ${LIB_DBG}
	$(CC_DBG) $(CFLAGS_DBG) $(INCL) $(LFLAGS) -o test-tool2 test-tool2.c \
		tool2.tif.c -L../toolbus -lATB-dbg ${LIBS_DBG}

tool2.tif.c tool2.tif.h: test2.tifs
	../toolbus/tifstoc -tool tool2 test2.tifs

test2.tifs: test2.tb
	$(TOOLBUS) -gentifs test2.tb
	

depend: tool2.tif.c tool2.tif.h
	$(CC_GCC) -MM $(DEFS) $(INCL) $(TESTSRCS) > /tmp/.gendep
	cat /tmp/.gendep | sed "s/.o:/-cc.o:/"   >  .depend
	cat /tmp/.gendep | sed "s/.o:/-gcc.o:/"  >> .depend
	cat /tmp/.gendep | sed "s/.o:/-dbg.o:/"  >> .depend
	cat /tmp/.gendep | sed "s/.o:/-prof.o:/" >> .depend
	rm -f /tmp/.gendep

tag:
	ctags *.[ch]
include .depend
