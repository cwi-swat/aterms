# @configure_input@

PRODUCT		= @PRODUCT@
VERSION		= @VERSION@

srcdir		= @srcdir@
top_srcdir	= @top_srcdir@
prefix		= @prefix@
exec_prefix	= @exec_prefix@
bindir      = $(exec_prefix)/bin
libdir      = $(exec_prefix)/lib
includedir  = $(prefix)/include

CC_GCC		= @CC_GCC@
CC_CC		= @CC_CC@
CC_DBG		= @CC_DBG@
CC_PROF		= @CC_PROF@

CFLAGS_CC	= @CFLAGS_CC@
CFLAGS_GCC	= @CFLAGS_GCC@
CFLAGS_DBG	= @CFLAGS_DBG@
CFLAGS_PROF	= @CFLAGS_PROF@

DEFS_CC		= @DEFS_CC@
DEFS_GCC	= @DEFS_GCC@
DEFS_DBG	= @DEFS_DBG@
DEFS_PROF	= @DEFS_PROF@

INCL_CC		= @INCL_CC@
INCL_GCC	= @INCL_GCC@
INCL_DBG	= @INCL_DBG@
INCL_PROF	= @INCL_PROF@

LFLAGS_CC	= @LFLAGS_CC@
LFLAGS_GCC	= @LFLAGS_GCC@
LFLAGS_DBG	= @LFLAGS_DBG@
LFLAGS_PROF	= @LFLAGS_PROF@

AR			= @AR@
AR_FLAGS	= cr

INSTALL		= @INSTALL@
INSTALL_PRG	= @INSTALL_PRG@
INSTALL_DAT	= @INSTALL_DAT@

ATBSRCS		= atb-tool.c ctif.c
ATBLIBS		= libATB-gcc.a libATB-cc.a libATB-dbg.a libATB-prof.a
PROGS		= ctif
PUBLIC_INCL	= atb-tool.h
PRIVATE_INCL	=
ATBINCL		= ${PUBLIC_INCL} ${PRIVATE_INCL}
DISTFILES	= Makefile.in ${ATBSRCS} ${ATBINCL}

OBJ_CC		= $(patsubst %.c,%-cc.o,$(ATBSRCS))
OBJ_GCC		= $(patsubst %.c,%-gcc.o,$(ATBSRCS))
OBJ_DBG		= $(patsubst %.c,%-dbg.o,$(ATBSRCS))
OBJ_PROF	= $(patsubst %.c,%-prof.o,$(ATBSRCS))

all: $(ATBLIBS) $(PROGS)

clean:
	@CLEAN@ ${PROGS}

dist: ${DISTFILES}
	@cp ${DISTFILES} ${DISTDIR}	

install: ${ATBLIBS} ${PUBLIC_INCL} ${PROGS}
	@for file in ${ATBLIBS}; do \
		${INSTALL_DAT} $$file ${libdir}; \
	done
	@for file in ${PUBLIC_INCL}; do \
		${INSTALL_DAT} $$file ${includedir}; \
	done
	@for file in ${PROGS}; do \
		${INSTALL_PRG} $$file ${bindir}; \
	done

%-cc.o: %.c
	${CC_CC} ${CFLAGS_CC} -I../aterm -c -o $@ $<

%-gcc.o: %.c
	${CC_GCC} ${CFLAGS_GCC} -I../aterm -c -o $@ $<

%-dbg.o: %.c
	${CC_DBG} ${CFLAGS_DBG} -I../aterm -c -o $@ $<

%-prof.o: %.c
	${CC_PROF} ${CFLAGS_PROF} -I../aterm -c -o $@ $<

libATB-cc.a: ${OBJ_CC}
	${AR} ${AR_FLAGS} $@ ${OBJ_CC}

libATB-gcc.a:	${OBJ_GCC}
	${AR} ${AR_FLAGS} $@ ${OBJ_GCC}

libATB-dbg.a: ${OBJ_DBG}
	${AR} ${AR_FLAGS} $@ ${OBJ_DBG}

libATB-prof.a: ${OBJ_PROF}
	${AR} ${AR_FLAGS} $@ ${OBJ_PROF}

ctif: ctif.c atb-tool.h ../aterm/libATerm-dbg.a libATB-dbg.a
	${CC_DBG} ${CFLAGS_DBG} -I../aterm -o ctif ctif.c \
			-L../aterm -lATerm-dbg -L. -lATB-dbg -lsocket -lnsl

tag:
	ctags -t *.[ch]

depend:
	$(CC_GCC) -MM $(DEFS_CC) $(INCL_CC) -I../aterm $(ATBSRCS) > /tmp/.gendep
	cat /tmp/.gendep | sed "s/.o:/-cc.o:/"   >  .depend
	$(CC_GCC) -MM $(DEFS_GCC) $(INCL_GCC) -I../aterm $(ATBSRCS) > /tmp/.gendep
	cat /tmp/.gendep | sed "s/.o:/-gcc.o:/"  >> .depend
	$(CC_GCC) -MM $(DEFS_DBG) $(INCL_DBG) -I../aterm $(ATBSRCS) > /tmp/.gendep
	cat /tmp/.gendep | sed "s/.o:/-dbg.o:/"  >> .depend
	$(CC_GCC) -MM $(DEFS_PROF) $(INCL_PROF) -I../aterm $(ATBSRCS) > /tmp/.gendep
	cat /tmp/.gendep | sed "s/.o:/-prof.o:/" >> .depend
	rm -f /tmp/.gendep

.depend:
	$(CC_GCC) -MM $(DEFS_CC) $(INCL_CC) -I../aterm $(ATBSRCS) > /tmp/.gendep
	cat /tmp/.gendep | sed "s/.o:/-cc.o:/"   >  .depend
	$(CC_GCC) -MM $(DEFS_GCC) $(INCL_GCC) -I../aterm $(ATBSRCS) > /tmp/.gendep
	cat /tmp/.gendep | sed "s/.o:/-gcc.o:/"  >> .depend
	$(CC_GCC) -MM $(DEFS_DBG) $(INCL_DBG) -I../aterm $(ATBSRCS) > /tmp/.gendep
	cat /tmp/.gendep | sed "s/.o:/-dbg.o:/"  >> .depend
	$(CC_GCC) -MM $(DEFS_PROF) $(INCL_PROF) -I../aterm $(ATBSRCS) > /tmp/.gendep
	cat /tmp/.gendep | sed "s/.o:/-prof.o:/" >> .depend
	rm -f /tmp/.gendep

include .depend
