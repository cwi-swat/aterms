# vim:ts=8:sw=8

PRODUCT		= @PRODUCT@
VERSION		= @VERSION@

srcdir		= @srcdir@
top_srcdir	= @top_srcdir@
prefix		= @prefix@
exec_prefix	= @exec_prefix@
bindir		= @bindir@
libdir		= @libdir@
includedir  	= $(prefix)/include

CC_GCC		= @CC_GCC@
CC_CC		= @CC_CC@
CC_DBG		= @CC_DBG@
CC_PROF		= @CC_PROF@
CC_NS		= @CC_CC@

CFLAGS_CC	= @CFLAGS_CC@
CFLAGS_GCC	= @CFLAGS_GCC@
CFLAGS_DBG	= @CFLAGS_DBG@
CFLAGS_PROF	= @CFLAGS_PROF@
CFLAGS_NS	= @CFLAGS_CC@

DEFS_CC		= @DEFS_CC@
DEFS_GCC	= @DEFS_GCC@
DEFS_DBG	= @DEFS_DBG@
DEFS_PROF	= @DEFS_PROF@
DEFS_NS		= @DEFS_CC@ -DNO_SHARING

INCL_CC		= @INCL_CC@
INCL_GCC	= @INCL_GCC@
INCL_DBG	= @INCL_DBG@
INCL_PROF	= @INCL_PROF@
INCL_NS		= @INCL_CC@

LFLAGS_CC	= @LFLAGS_CC@
LFLAGS_GCC	= @LFLAGS_GCC@
LFLAGS_DBG	= @LFLAGS_DBG@
LFLAGS_PROF	= @LFLAGS_PROF@
LFLAGS_NS	= @LFLAGS_CC@

LIBS_CC		= @LIBS@
LIBS_GCC        = @LIBS@
LIBS_DBG        = @LIBS@
LIBS_PROF       = @LIBS@
LIBS_NS         = @LIBS@

AR		= @AR@
AR_FLAGS	= cr
RANLIB		= @RANLIB@

INSTALL		= @INSTALL@
INSTALL_PRG	= @INSTALL_PRG@
INSTALL_DAT	= @INSTALL_DAT@

LIBSRCS		= atb-tool.c
ATBSRCS		= ${LIBSRCS} tifstoc.c
ATBLIBS		= libATB-gcc.a libATB-cc.a libATB-dbg.a libATB-prof.a \
		libATB-ns.a
PROGS		= tifstoc
PUBLIC_INCL	= atb-tool.h
PRIVATE_INCL	=
ATBINCL		= ${PUBLIC_INCL} ${PRIVATE_INCL}
DISTFILES	= .depend Makefile.in ${ATBSRCS} ${ATBINCL}

OBJ_CC		= $(patsubst %.c,%-cc.o,$(LIBSRCS))
OBJ_GCC		= $(patsubst %.c,%-gcc.o,$(LIBSRCS))
OBJ_DBG		= $(patsubst %.c,%-dbg.o,$(LIBSRCS))
OBJ_PROF	= $(patsubst %.c,%-prof.o,$(LIBSRCS))
OBJ_NS		= $(patsubst %.c,%-ns.o,$(LIBSRCS))

all: $(ATBLIBS) $(PROGS)

clean:
	@CLEAN@ ${PROGS}

dist: ${DISTFILES}
	@cp ${DISTFILES} ${DISTDIR}	

install: ${ATBLIBS} ${PUBLIC_INCL} ${PROGS}
	@for file in ${ATBLIBS}; do \
		${INSTALL_DAT} $$file ${libdir}; \
		${RANLIB} ${libdir}/$$file; \
	done
	@for file in ${PUBLIC_INCL}; do \
		${INSTALL_DAT} $$file ${includedir}; \
	done
	@for file in ${PROGS}; do \
		${INSTALL_PRG} $$file ${bindir}; \
	done

%-cc.o: %.c
	${CC_CC} ${CFLAGS_CC} ${DEFS_CC} -I../aterm -c -o $@ $<

%-gcc.o: %.c
	${CC_GCC} ${CFLAGS_GCC} ${DEFS_GCC} -I../aterm -c -o $@ $<

%-dbg.o: %.c
	${CC_DBG} ${CFLAGS_DBG} ${DEFS_DBG} -I../aterm -c -o $@ $<

%-prof.o: %.c
	${CC_PROF} ${CFLAGS_PROF} ${DEFS_PROF} -I../aterm -c -o $@ $<

%-ns.o: %.c
	${CC_NS} ${CFLAGS_NS} ${DEFS_NS} -I../aterm -c -o $@ $<

libATB-cc.a: ${OBJ_CC}
	${AR} ${AR_FLAGS} $@ ${OBJ_CC}
	${RANLIB} $@

libATB-gcc.a:	${OBJ_GCC}
	${AR} ${AR_FLAGS} $@ ${OBJ_GCC}
	${RANLIB} $@

libATB-dbg.a: ${OBJ_DBG}
	${AR} ${AR_FLAGS} $@ ${OBJ_DBG}
	${RANLIB} $@

libATB-prof.a: ${OBJ_PROF}
	${AR} ${AR_FLAGS} $@ ${OBJ_PROF}
	${RANLIB} $@

libATB-ns.a: ${OBJ_NS}
	${AR} ${AR_FLAGS} $@ ${OBJ_NS}
	${RANLIB} $@

tifstoc: tifstoc.c atb-tool.h ../aterm/libATerm-dbg.a libATB-dbg.a
	${CC_DBG} ${CFLAGS_DBG} -I../aterm -o tifstoc tifstoc.c \
			-L../aterm -lATerm-dbg -L. -lATB-dbg ${LIBS_DBG}

tag:
	ctags *.[ch]

depend:
	$(CC_GCC) -MM $(DEFS_CC) $(INCL_CC) -I../aterm $(ATBSRCS) > /tmp/.gendep
	cat /tmp/.gendep | sed "s/.o:/-cc.o:/"   >  .depend
	$(CC_GCC) -MM $(DEFS_GCC) $(INCL_GCC) -I../aterm $(ATBSRCS) > /tmp/.gendep
	cat /tmp/.gendep | sed "s/.o:/-gcc.o:/"  >> .depend
	$(CC_GCC) -MM $(DEFS_DBG) $(INCL_DBG) -I../aterm $(ATBSRCS) > /tmp/.gendep
	cat /tmp/.gendep | sed "s/.o:/-dbg.o:/"  >> .depend
	$(CC_GCC) -MM $(DEFS_PROF) $(INCL_PROF) -I../aterm $(ATBSRCS) > /tmp/.gendep
	cat /tmp/.gendep | sed "s/.o:/-prof.o:/" >> .depend
	rm -f /tmp/.gendep

include .depend
