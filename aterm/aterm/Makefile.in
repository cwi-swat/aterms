PRODUCT		= @PRODUCT@
VERSION		= @VERSION@

srcdir		= @srcdir@
top_srcdir	= @top_srcdir@
prefix		= @prefix@
exec_prefix	= @exec_prefix@
bindir      	= $(exec_prefix)/bin
libdir      	= $(exec_prefix)/lib
includedir  	= $(prefix)/include

CC_GCC		= @CC_GCC@
CC_CC		= @CC_CC@
CC_DBG		= @CC_DBG@
CC_PROF		= @CC_PROF@

CFLAGS_CC	= @CFLAGS_CC@
CFLAGS_GCC	= @CFLAGS_GCC@
CFLAGS_DBG	= @CFLAGS_DBG@
CFLAGS_PROF	= @CFLAGS_PROF@

DEFS_CC		= @DEFS_CC@
DEFS_GCC	= @DEFS_GCC@
DEFS_DBG	= @DEFS_DBG@
DEFS_PROF	= @DEFS_PROF@

INCL_CC		= @INCL_CC@
INCL_GCC	= @INCL_GCC@
INCL_DBG	= @INCL_DBG@
INCL_PROF	= @INCL_PROF@

LFLAGS_CC	= @LFLAGS_CC@
LFLAGS_GCC	= @LFLAGS_GCC@
LFLAGS_DBG	= @LFLAGS_DBG@
LFLAGS_PROF	= @LFLAGS_PROF@

AR		= @AR@
AR_FLAGS	= cr

INSTALL		= @INSTALL@
INSTALL_PRG	= @INSTALL_PRG@
INSTALL_DAT	= @INSTALL_DAT@

PROGS		= termsize baffle
PROGSRCS	= termsize.c baffle.c
ATERMSRCS	= aterm.c list.c make.c memory.c asymbol.c gc.c bafio.c
ATERMLIBS	= libATerm-gcc.a libATerm-cc.a libATerm-dbg.a libATerm-prof.a
PUBLIC_INCL	= abool.h aterm1.h aterm2.h deprecated.h encoding.h asymbol.h
PRIVATE_INCL	= _aterm.h debug.h gc.h list.h make.h memory.h util.h
ATERMINCL	= ${PUBLIC_INCL} ${PRIVATE_INCL}
DISTFILES	= Makefile.in .depend ${PROGSRCS} ${ATERMSRCS} ${ATERMINCL}

OBJ_CC		= $(patsubst %.c,%-cc.o,$(ATERMSRCS))
OBJ_GCC		= $(patsubst %.c,%-gcc.o,$(ATERMSRCS))
OBJ_DBG		= $(patsubst %.c,%-dbg.o,$(ATERMSRCS))
OBJ_PROF	= $(patsubst %.c,%-prof.o,$(ATERMSRCS))

all: $(ATERMLIBS) $(PROGS)

clean:
	@CLEAN@

dist: ${DISTFILES}
	@cp ${DISTFILES} ${DISTDIR}	

install: ${ATERMLIBS} ${PUBLIC_INCL}
	@for file in ${ATERMLIBS}; do \
		${INSTALL_DAT} $$file ${libdir}; \
	done
	@for file in ${PUBLIC_INCL}; do \
		${INSTALL_DAT} $$file ${includedir}; \
	done
	@for file in ${PROGS}; do \
		${INSTALL_PRG} $$file ${bindir}; \
	done

%-cc.o: %.c
	${CC_CC} ${CFLAGS_CC} -c -o $@ $<

%-gcc.o: %.c
	${CC_GCC} ${CFLAGS_GCC} -c -o $@ $<

%-dbg.o: %.c
	${CC_DBG} ${CFLAGS_DBG} -c -o $@ $<

%-prof.o: %.c
	${CC_PROF} ${CFLAGS_PROF} -c -o $@ $<

libATerm-cc.a: ${OBJ_CC}
	${AR} ${AR_FLAGS} $@ ${OBJ_CC}

libATerm-gcc.a:	${OBJ_GCC}
	${AR} ${AR_FLAGS} $@ ${OBJ_GCC}

libATerm-dbg.a: ${OBJ_DBG}
	${AR} ${AR_FLAGS} $@ ${OBJ_DBG}

libATerm-prof.a: ${OBJ_PROF}
	${AR} ${AR_FLAGS} $@ ${OBJ_PROF}

baffle: baffle.c libATerm-dbg.a
	${CC_DBG} ${CFLAGS_DBG} -o $@ $< -L. -lATerm-dbg

termsize: termsize.c libATerm-cc.a
	${CC_CC} ${CFLAGS_CC} -o $@ $< -L. -lATerm-cc

tag:
	ctags *.[ch]

depend:
	$(CC_GCC) -MM $(DEFS_CC) $(INCL_CC) $(ATERMSRCS) > /tmp/.gendep
	cat /tmp/.gendep | sed "s/.o:/-cc.o:/"   >  .depend
	$(CC_GCC) -MM $(DEFS_GCC) $(INCL_GCC) $(ATERMSRCS) > /tmp/.gendep
	cat /tmp/.gendep | sed "s/.o:/-gcc.o:/"  >> .depend
	$(CC_GCC) -MM $(DEFS_DBG) $(INCL_DBG) $(ATERMSRCS) > /tmp/.gendep
	cat /tmp/.gendep | sed "s/.o:/-dbg.o:/"  >> .depend
	$(CC_GCC) -MM $(DEFS_PROF) $(INCL_PROF) $(ATERMSRCS) > /tmp/.gendep
	cat /tmp/.gendep | sed "s/.o:/-prof.o:/" >> .depend
	rm -f /tmp/.gendep

include .depend
