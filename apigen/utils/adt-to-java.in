#!/bin/sh

# {{{ variables

     PRG=`basename $0`
  prefix=@prefix@

# }}}

# {{{ usage()

usage() {
cat << ENDCAT >&2
Usage: $PRG -i <adt-file> [options]

Parameters:

  -i | --input <FILE>     specify input adt                [not specified]
  -o | --output <DIR>     specify basedir for output       [.]
  -p | --package <STR>    specify package                  [""]
  -m | --import <PKG>     specify extra import package     [see below]
  -v | --verbose          be verbose during generation     [off]
  -h | --help             display this information

Default locations:
  classes = ${CLASSES}

Example: $PRG -i Booleans.adt --package sdf -m 'java.util.*'

ENDCAT
}

# }}}

# {{{  info()

info () {
  if [ $VERBOSE -gt 0 ]; then
    echo $* >&2
   fi
}

# }}}
# {{{  error()

error() {
  echo "${PRG}: $*" >&2
  exit 1
}

# }}}
# {{{  require()

require() {
  [ -f $1 ] || error "no such file: $1"
}

# }}}

# {{{  default settings

# settings/options
     INPUT=""
   VERBOSE=0

# data needed
CLASSES=${prefix}/classes

# }}}

# {{{  handle command line options

if [ $# -eq 0 ]; then
  usage
  exit 1
fi

while [ $# -gt 0 ]
do
  case $1 in
    -i | --input)
      shift; INPUT=$1 ;;

    -o | --output)
      shift; OUTPUT=$1 ;;

    -p | --package)
      shift; OPT_PACKAGE=$1 ;;

    -m | --import)
      shift; OPT_IMPORTS="${OPT_IMPORTS} -import $1" ;;

    -v | --verbose)
      VERBOSE=1 ;;

    -h | --help)
      usage; exit 0 ;;

    *)
      error "unknown option: $1"
  esac
  shift
done

# }}}

# {{{ sanity checks and variable setup

if [ "a${INPUT}" = "a" ]; then
  error "no input file specified (use -i <file>)"
else
  require ${INPUT}
fi

if [ "a${OUTPUT}" = "a" ]; then
  OUTPUT="."
fi

if [ "a${OPT_PACKAGE}" = "a" ]; then
  OPT_PACKAGE=""
else
  OPT_PACKAGE="-package ${OPT_PACKAGE}"
fi

if [ $VERBOSE -gt 0 ]; then
  OPT_VERBOSE="-verbose"
else
  OPT_VERBOSE=""
fi

# }}}

# {{{  generate Java code from ADT
java  -classpath ${CLASSES} apigen.java.JavaGen \
	  -input ${INPUT}	\
	  -basedir ${OUTPUT}	\
	  ${OPT_IMPORTS}	\
	  ${OPT_PACKAGE}	\
	  ${OPT_VERBOSE}

# }}}
