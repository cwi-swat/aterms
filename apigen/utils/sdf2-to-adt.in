#!/bin/sh

PRG=`basename $0`
DATE=`date`
# {{{ autoconf variables

prefix=@prefix@
exec_prefix=@exec_prefix@
bindir=@bindir@
datadir=@datadir@
SGLRBIN=@SGLRBIN@
XTBIN=@XTBIN@

# }}}

# {{{ usage()

usage() {
cat << ENDCAT >&2
Usage: $PRG <module-name> <version>
Example: $PRG Rolodex 1.0
ENDCAT
}

# }}}

# {{{ check argument count

if test $# != 2
then
  usage
  exit 1
fi

# }}}

# {{{ Variable section

MODULE=`basename $1 .sdf`
MODULE=`basename $MODULE .sdf2`
VERSION=$2
SDFFILE="$1"
PROLOGUE="${MODULE}.pro"
ADTFILE="${MODULE}.adt"

SGLR=${SGLRBIN}/sglr
ASOURCE=asource

SDF2TOADT="${bindir}/Sdf2-to-ADT"
TABLE="${datadir}/Sdf2-to-ADT.trm.tbl"

GENCAPI="${bindir}/gen-c-api"

ADDLABELS="${XTBIN}/add-labels"

# }}}

# {{{ Sanity checks

if test ! -f ${SDFFILE}
then
  echo "could not open sdf-file: ${SDFFILE}" >&2
  exit 1
fi

#if test ! -f ${PROLOGUE}
#then
#  echo "could not open prologue-file: ${PROLOGUE}" >&2
#  exit 1
#fi

# }}}

echo "sdf-to-adt(`${ADDLABELS} ${SDFFILE}`)" | \
${SGLR} -1 -p ${TABLE} | \
${SDF2TOADT} | \
${ASOURCE} > ${ADTFILE}

${GENCAPI} ${MODULE} ${VERSION}

