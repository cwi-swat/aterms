#!/bin/sh

PRG=`basename $0`
DATE=`date`
# {{{ autoconf variables

prefix=@prefix@
exec_prefix=@exec_prefix@
bindir=@bindir@
datadir=@datadir@
SGLRBIN=@SGLRBIN@
XTBIN=@XTBIN@

# }}}

# {{{ usage()

usage() {
cat << ENDCAT >&2
Usage: $PRG <SDF2-module>
Example: $PRG Booleans.sdf
ENDCAT
}

# }}}

# {{{ check argument count

if test $# != 1
then
  usage
  exit 1
fi

# }}}

# {{{ Variable section

MODULE=$1
CONSOPT='cons-remove'
MODULE=`basename $MODULE .sdf`
MODULE=`basename $MODULE .sdf2`
SDFFILE="$1"
ADTFILE="${MODULE}.adt"

SGLR=${SGLRBIN}/sglr
ASOURCE=asource

SDF2TOADT="${bindir}/Sdf2-to-ADT"
TABLE="${datadir}/Sdf2-to-ADT.trm.tbl"

ADDLABELS="${XTBIN}/add-labels"

# }}}

# {{{ Sanity checks

if test ! -f ${SDFFILE}
then
  echo "could not open sdf-file: ${SDFFILE}" >&2
  exit 1
fi

#if test ! -f ${PROLOGUE}
#then
#  echo "could not open prologue-file: ${PROLOGUE}" >&2
#  exit 1
#fi

# }}}

echo "sdf-to-adt(`${ADDLABELS} ${SDFFILE}`, $CONSOPT)" | \
${SGLR} -1 -p ${TABLE} | \
${SDF2TOADT} | \
${ASOURCE} > ${ADTFILE}

