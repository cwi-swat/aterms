dnl
dnl vim:ts=8:sw=8:sts=0
dnl
dnl $Id$
dnl

dnl Process this file with autoconf to produce a configure script.
AC_INIT(configure.in)
AM_INIT_AUTOMAKE(apigen, 0.7)

dnl Add current dir to searchpath
ACLOCAL="${ACLOCAL} -I ."

dnl Our own version of libdir whose value is set dynamically
AC_SUBST(INSTLIBDIR)
INSTLIBDIR="$libdir"

AC_REQUIRE([AC_PROG_CC])

dnl What commands are needed to set the variable MAKE in Makefiles?
AC_SET_MAKE

dnl {{{ Ranlib stuff

AC_PROG_RANLIB
AR=ar
AC_SUBST(AR)

dnl }}}
dnl {{{  Determine which libraries to use for programs using sockets

NOSOCKLIBS=$LIBS
dnl first, the socket functions
SOCKET_FOUND=no
SOCKLIBS=
AC_CHECK_LIB(sun,socket,[SOCKET_FOUND=yes;SOCKLIBS="-lsun"])
if test ${SOCKET_FOUND} = no; then
  AC_CHECK_LIB(socket, socket,[SOCKET_FOUND=yes;SOCKLIBS="-lsocket"])
  if test ${SOCKET_FOUND} = no; then
    AC_CHECK_LIB(bsd,socket,[SOCKET_FOUND=yes;SOCKLIBS="-lbsd";DEFS="$DEFS -D_BS
D=43"])
  fi
fi

dnl then gethostname
GHN_FOUND=no
AC_CHECK_LIB(sun,gethostname,[GHN_FOUND=yes])
if test ${GHN_FOUND} = no; then
  AC_CHECK_LIB(nsl,gethostname,[GHN_FOUND=yes;SOCKLIBS="$SOCKLIBS -lnsl"])
fi

LIBS=$NOSOCKLIBS
AC_CHECK_LIB(dl, dlopen)

dnl Checks for header files.
AC_CHECK_HEADER(getopt.h)

AC_SUBST(SOCKLIBS)

dnl }}}

dnl {{{ Handle --with-aterm

AC_PACKAGE_REQUIRE(aterm, baffle,
	[  --with-aterm=DIR        ATerm-library is in DIR])
AC_SUBST(ATERM)

ATERMINC="${ATERM}/include"
AC_SUBST(ATERMINC)

ATERMLIB="${ATERM}/lib"
AC_SUBST(ATERMLIB)

dnl }}}

dnl {asc,pt}-support are needed to use a compiled specification
dnl {{{ Handle --with-asc-support

AC_ARG_WITH(asfc-runtime,
	[  --with-asc-support=DIR  asc-support is in DIR],
	ASCSUPPORT=${withval},
	ASCSUPPORT=${prefix})

ASCINC=${ASCSUPPORT}/include
AC_SUBST(ASCINC)

ASCLIB=${ASCSUPPORT}/lib
AC_SUBST(ASCLIB)

dnl }}}
dnl {{{ Handle --with-pt-support

AC_PACKAGE_REQUIRE(pt-support, asource,
	[  --with-pt-support=DIR   ParseTree distribution is in DIR])
AC_SUBST(PT_SUPPORT)

ASFIXINC=${PT_SUPPORT}/include
AC_SUBST(ASFIXINC)

ASFIXLIB=${PT_SUPPORT}/lib
AC_SUBST(ASFIXLIB)

ASOURCEBIN=${PT_SUPPORT}/bin
AC_SUBST(ASOURCEBIN)

dnl }}}

dnl {{{ Handle --with-pgen

AC_PACKAGE_REQUIRE(pgen, sdf2table,
	[  --with-pgen=DIR         pgen distribution is in DIR])
AC_SUBST(PGEN)

PGENBIN=${PGEN}/bin
AC_SUBST(PGENBIN)

dnl }}}
dnl {{{ Handle --with-sglr

AC_PACKAGE_REQUIRE(sglr, sglr,
	[  --with-sglr=DIR         sglr is in DIR])
AC_SUBST(SGLR)

SGLRBIN=${SGLR}/bin
AC_SUBST(SGLRBIN)

dnl }}}

AC_PACKAGE_REQUIRE(asfe, asfe,
	[  --with-asfe=DIR         asf-evaluator is in DIR])
AC_SUBST(ASFE)

EVALBIN=${ASFE}/bin
AC_SUBST(EVALBIN)

dnl {{{ Output files

dnl Which files need updating?
AC_OUTPUT(
Makefile
spec/Makefile
utils/Makefile
utils/sdf2-to-adt
utils/adt-to-c
apigen/Makefile
apigen/c/Makefile
test/Makefile
doc/Makefile
doc/paper/Makefile
spec/sdf2-to-adt/Makefile
spec/add-labels/Makefile
,
chmod +x utils/sdf2-to-adt utils/adt-to-c
)

dnl }}}
